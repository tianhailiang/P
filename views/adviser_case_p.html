<!DOCTYPE html>
<html>
<head lang="en">
    {% include "header_new.html" %}
    <link rel="stylesheet" href="{{helper.cdnhost}}/dep/css/idangerous.swiper2.7.6.css" >
    <script src="{{helper.cdnhost}}/dep/js/idangerous.swiper2.7.6.js"></script>
</head>
<style>
    .right-cont .loadMore{
        width: 100%;
        height: 40px;
        text-align: center;
        line-height: 40px;
        border-top: 1px solid #dcdcdc;
        cursor: pointer;
        font-size: 14px;
        color: #666;
    }
    .list-h{
        height:130px;
    }
    .list-h img{
        display: block;
        width:100%;
        height:100%;
    }
</style>
<body style="background: #f5f5f5">
{% include "widget/top/top.html" %}
{% import "widget/nav_seventh/nav_seventh.html" as nav_seventh %}
{{ nav_seventh.nav_seventh(route,tdk.cityid,helper) }}
<div class="dui-layout-lg clearfix list-h" style="margin-top: 20px;margin-bottom: 20px" id="AD_{% if userinfo.usertype == 2 %}ADVISOR{% elif userinfo.usertype == 3 %}CANZAN{% endif %}_P_CASE_SEAT1"></div>
<div class="dui-layout-lg clearfix">
    <div class="dui-layout-silde">
        <div class="clearfix">
            {% if userinfo.status == 1 %} {#离职#}
            {% import "widget2/community_advisor/community_advisor.html" as advisor_leave %}
            {{ advisor_leave.advisor_leave(userinfo,helper,login_info) }}
            {% else %} {#在职#}
            {% if userinfo.usertype == 2 %}
            {% import "widget2/community_advisor/community_advisor.html" as advisor %}
            {{ advisor.advisor(userinfo,helper,login_info) }}
            {% elseif userinfo.usertype == 3 %}
            {% import "widget2/community_advisor/community_advisor.html" as counsellor %}
            {{ counsellor.counsellor(userinfo,helper,login_info) }}
            {% endif %}
            {% endif %}
        </div>
        <div style="margin-top: 20px;" class="dui-box-shadow">
            <div class="common-title" style="border:1px solid #dcdcdc;">
                <i></i>
                <h3>作者精选</h3>
            </div>
            {% esi helper.include(esikey,'fragment/author_selection','uid='+to_uid) %}
        </div>
      <div style="margin-top: 20px;" class="dui-box-shadow">
        <div class="common-title" style="border:1px solid #dcdcdc;">
          <i></i>
          <h3>猜你喜欢</h3>
        </div>
        {% esi helper.include(esikey,'fragment/guess_like','n='+country,'c='+tdk.cityid) %}
      </div>
        <div class="huod-lod clearfix dui-box-shadow" style="margin-top: 20px">
            <div class="expert_unscramble_title expert_unscramble_title_new">
                <i></i><h3>活动预告</h3> <a target="_blank" href="javascript:void(0);"></a>
            </div>
            <div style="background:#fff;" >
               {% esi helper.include(esikey,'fragment/huodongyugao','pos=cmslist','c='+tdk.cityid,'n='+hcountry) %}
            </div>
        </div>
    </div>
    <div class="dui-layout-div"></div>
    <div class="dui-layout-con dui-box-shadow" style="background-color: #fff;">
        <div class="right-cont case-cont">
            {% if userinfo.status == 1 %} {#离职顾问#}
            {% import "widget2/community_nav/community_nav.html" as adviser_nav_leave %}
            {{adviser_nav_leave.adviser_nav_leave('案例', userinfo.uid, helper)}}
            {% else %} {#在职顾问#}
            {% if userinfo.usertype == 2 %}
            {% import "widget2/community_nav/community_nav.html" as adviser_nav %}
            {{adviser_nav.adviser_nav('案例', userinfo.uid, helper)}}
            {% elif userinfo.usertype == 3 %}
            {% import "widget2/community_nav/community_nav.html" as canzan_nav %}
            {{canzan_nav.canzan_nav('案例', userinfo.uid, helper)}}
            {% endif %}
            {% endif %}
            {% if case_data.list.length > 0 %}
                <div class="right-main clearfix">
                    {% for item in case_data.list %}
                        {% import "widget2/offer/offer.html" as case_show %}
                          {{ case_show.case_show(item, helper) }}
                        {% include "widget2/bottom_comment/bottom_comment.html" %}
                    {% endfor %}
                </div>
                <div class="loadMore" data-page="1" data-uid="{{userinfo.uid}}" style="height: 54px;line-height: 54px">
                    <span>加载更多</span>
                    <i class="iconfont">&#xe60b;</i>
                </div>
            {% else %}
              {% include "widget2/blank/blank.html" %}
            {% endif %}
        </div>
    </div>
</div>
<div class="dui-layout-lg clearfix">
    <div class="dui-box-shadow clearfix" style="margin-top: 20px;background:#fff;" >
        <div class="common-title">
            <i></i>
            <h3>热门留学方案</h3>
            <a target="_blank" href="{{helper.urlgen('productrank')}}" class="iconfont">&#xe602;</a>
        </div>
        {% esi helper.include(esikey,'fragment/hot_liuxuefangan_list') %}
    </div>
    <div class="dui-box-shadow" style="margin-top: 20px;background:#fff;margin-bottom: 20px;">
        <div class="common-title">
            <i></i>
            <h3>明星顾问</h3>
            <a target="_blank" href="{{helper.urlgen('adviser')}}" class="iconfont">&#xe602;</a>
        </div>
            {% esi helper.include(esikey,'fragment/community_guwen','n='+hcountry) %}
    </div>
</div>
{% import "widget/slide/slide.html" as  slide %}
{{slide.leyu_slide("AD_"+tdk.pagekey+"_SEAT10") }}
{% include "widget/footer/footer.html" %}
<script>
  var login_ss = null; 
  if($.cookie('login_ss') != undefined){
    login_ss = JSON.parse($.cookie('login_ss'));
  }
</script>
<script src="{{helper.cdnhost}}/assets/js/show_advert.js"></script>
<script src="{{helper.cdnhost}}/assets/js/nav_seventh.js" ></script>
<script src="{{helper.cdnhost}}/assets/js/bottom_comment.js"></script>
<script src="{{helper.cdnhost}}/assets/js/follow.js"></script>
<script src="{{helper.cdnhost}}/assets/js/slide.js"></script>
<script src="{{helper.cdnhost}}/assets/js/online_evaluation.js"></script>
<script src="{{helper.cdnhost}}/assets/js/footer.js"></script>
<script src="{{helper.cdnhost}}/assets/js/layer.min.js"></script>
<script src="{{helper.cdnhost}}/assets/js/xSlider.js" ></script>
<script>
    $(function() {
        console.log(fn.getEdu);
        function appendCase (caseArr) {
            var caseHtml = '';
            for (var i = 0; i < caseArr.length; i++) {
                if(caseArr[i].introduce==undefined){
                    caseArr[i].introduce ={
                      stu_name:'',
                      school_1:'',
                      school_2:'',
                      school_3:'',
                      dep_1:'',
                      dep_2:'',
                      dep_3:'',
                      admission_time:'',
                      offer_img:[]
                    };
                }
                caseHtml += '<div class="offers clearfix"><div class="offers-left"><div class="offers-left-img">';
                caseHtml += '<img src="'+fn.avaterimg(caseArr[i].uid,'small',caseArr[i].user_info.status,caseArr[i].user_info.status.version)+'" alt=""></div><div class="offers-left-off">';
                caseHtml += '<p class="off-p1">' + caseArr[i].user_info.realname + '</p>';
                caseHtml += '<p class="off-p2"> '+ caseArr[i].add_time +'&nbsp;&nbsp;<span>来自 : '+  caseArr[i].from +'</span></p>';
                caseHtml += '<a target="_blank" href="'+ fn.urlgen("case", caseArr[i].id.toString()) +'" class="offer-title">'+ caseArr[i].title +'</a>';
                caseHtml += '<p class="off-p3">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名&nbsp;:&nbsp;'+ caseArr[i].introduce.stu_name +'</p>';
                caseHtml += '<p class="off-p3">录取院校&nbsp;:&nbsp;'+ caseArr[i].introduce.school_1+'&nbsp;&nbsp;'+caseArr[i].introduce.school_2+'&nbsp;&nbsp;'+caseArr[i].introduce.school_3+'</p>';
                caseHtml += '<p class="off-p3">录取专业&nbsp;:&nbsp;'+ caseArr[i].introduce.dep_1+'&nbsp;&nbsp;'+caseArr[i].introduce.dep_2+'&nbsp;&nbsp;'+caseArr[i].introduce.dep_3+'</p>';
                caseHtml += '<p class="off-p3">学&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;历&nbsp;:&nbsp;'+ fn.getEdu(caseArr[i].edu_id) +'</p>';
                caseHtml += '<p class="off-p3">录取时间&nbsp;:&nbsp;'+ caseArr[i].introduce.admission_time +'</p>';
                caseHtml += '<p class="off-p4"><a target="_blank" href="'+ fn.urlgen("case", caseArr[i].id.toString()) +'">【查询详情】</a></p>';
                caseHtml += '</div> </div> <div class="offers-right"> <div class="offers-right-xiala"> <div class="offer-xialas"> <span class="offer-xialadd iconfont">&#xe60b;</span> <ul class="offer-xiala"> <li><a  class="dui-text-warning-s report-btn" data-artId="'+caseArr[i].id+'" data-catid="'+caseArr[i].category_id+'">举报</a></li> <li><a  class="dui-text-warning-s share-btn" data-url="'+fn.urlgen('case',caseArr[i].id.toString())+'" data-title ="'+caseArr[i].title+'">分享</a></li> </ul> </div> </div>';
                if (caseArr[i].introduce.offer_img !== null) {
                    caseHtml += '<div class="offers-right-off"> <div class="offers-right-offs"> <span>Offer展示:</span></div><div class="offers-right-offh">';
                    caseHtml += addImg(caseArr[i].introduce.offer_img);
                    caseHtml += '</div></div>';
                }
                caseHtml += '</div></div>';
                caseHtml += '<div class="bot_comment clearfix"><ul><li onclick="showbottom(1, '+caseArr[i].id+')" id="yuedu_li_'+caseArr[i].id+'"><i class="iconfont " id="yuedu_'+caseArr[i].id+'">&#xe9ca;</i><span id="yuedu_span_'+caseArr[i].id+'">阅读（<em id="yuedu_em_'+ caseArr[i].id +'">'+ caseArr[i].views +'</em>）</span></li><li onclick="showbottom(2, '+caseArr[i].id+')" id="shoucang_li_'+caseArr[i].id+'"><i class="iconfont " id="shoucang_'+caseArr[i].id+'">&#xe7ed;</i><span id="shoucang_span_'+caseArr[i].id+'">收藏（<em id="shoucang_em_'+ caseArr[i].id +'">'+ caseArr[i].favorites +'</em>）</span></li><li onclick="showbottom(3, '+caseArr[i].id+')" id="pinglun_li_'+caseArr[i].id+'"><i class="iconfont " id="pinglun_'+caseArr[i].id+'">&#xe61f;</i><span id="pinglun_span_'+caseArr[i].id+'">评论（<em id="pinglun_em_'+ caseArr[i].id +'">'+ caseArr[i].comments +'</em>）</span></li><li class="dian" onclick="showbottom(4, '+caseArr[i].id+')" id="dianzan_li_'+caseArr[i].id+'"><i class="iconfont " id="dianzan_'+caseArr[i].id+'">&#xe651;</i><span id="dianzan_span_'+caseArr[i].id+'">点赞（<em id="dianzan_em_'+ caseArr[i].id +'">'+ caseArr[i].votes +'</em>）</span></li></ul></div>';
            }
            $('.right-main').append($(caseHtml));
            $('.report-btn').on("click",report); //点击举报
            $('.share-btn').on('click',share); //点击分享
        }
        function addImg (imgList) {
            var html = '';
            for (var j=0; j<imgList.length; j++) {
                html += '<div class="img-box" ><img src="'+ fn.imageThumb(imgList[j],'110x130') +'" alt="" ></div>';
            }
            return html;
        }
        $('.loadMore').on('click', function () {
            var page = $(this).data('page')*1+1;
            var uid = $(this).data('uid');
            var per_page = 4;
            var thisObj = $(this);
            $.ajax({
                url: '/soapi/article_list',
                type: 'GET',
                datatype: 'json',
                data: {
                    u_id: uid,
                    type: 1,
                    page: page,
                    per_page: per_page
                },
                success: function (revmsg) {
                  console.log(revmsg)
                    var len = revmsg.data.list.length;
                    if (len < per_page) {
                        thisObj.html('案例加载完毕')
                    }
                    else {
                        appendCase(revmsg.data.list);
                        thisObj.data('page', page);
                    }
                },
                error:function(XMLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown)
                }
            })
        });
        $('.report-btn').on("click",report); //点击举报
        $('.share-btn').on('click',share); //点击分享
        function report(){
            //举报调取函数
            if(login_ss == undefined){
                layer.msg('你还没有登录')
                window.setTimeout(function(){
                  window.location.href =fn.curlgen('login','h='+window.location.href);
                },1000);
                return false;
            }
            var report_content = null;
            var that =this;
            layer.open({
                type: 1,
                title:'举报理由',
                area: ['700px'], //宽高
                content:'<div class="report-con">'+
                           '<ul class="report-ul clearfix">'+
                             '<li>'+
                               '<span class="circle"></span>'+
                               '<i class="iconfont">&#xe62a;</i>'+
                               '<span class="sp-con">垃圾、广告信息</span>'+
                              '</li>'+
                              '<li>'+
                                '<span class="circle"></span>'+
                                '<i class="iconfont">&#xe62a;</i>'+
                                '<span class="sp-con">色情、低俗内容</span>'+
                              '</li>'+
                              '<li>'+
                                '<span class="circle"></span>'+
                                '<i class="iconfont">&#xe62a;</i>'+
                                '<span class="sp-con">时政敏感话题</span>'+
                              '</li>'+
                              '<li>'+
                                '<span class="circle"></span>'+
                                '<i class="iconfont">&#xe62a;</i>'+
                                '<span class="sp-con">其它原因</span>'+
                              '</li>'+
                            '</ul>'+
                            '<textarea class="report-txt"></textarea>'+
                        '</div>',
                btn:'确定',
                closeBtn:'2',
                yes: function(index, layero){
                  if(report_content ==undefined || report_content == ''){
                    layer.msg('请选择举报理由');
                    return false;
                  }
                  $.ajax({
                    // url: ajaxUrlPrefix.cmsapi+'/api/userReport',
                    url:'/soapi/userReport',
                    type:'POST',
                    data:{
                      report_source:'1',
                      report_type:'1',
                      report_content:report_content,
                      userid:login_ss.uid,
                      artecle_id:$(that).attr("data-artId"),
                      catid:$(that).attr("data-catid")
                    },
                    dataType:'json',
                    // jsonpCallback:'callback',
                    success:function(result){
                      console.log(result)
                      if(result.code == 0){
                        layer.msg('举报成功');
                        layer.close(index); 
                      }
                    },
                    error:function(XMLHttpRequest, textStatus, errorThrown){
                      console.log(errorThrown)
                    }  
                  });
                }         
            });
            $(".report-ul li").on("click",function(){
                //选择举报内容
                $(".report-ul li i").hide();
                $(".report-ul li .circle").show();
                $(this).find("i").show();
                $(this).find(".circle").hide();
                if($(this).index() == 3){
                  $(".report-txt").show();
                  $(".layui-layer-content").css({"height":"115px"});
                }else{
                  $(".report-txt").hide();
                  $(".layui-layer-content").css({"height":"39px"});
                  report_content = $(this).find('.sp-con').text();
                }
            });
            $('.report-txt').on('change',function(){
                if($('.report-txt').val()!= ''){
                  report_content = $('.report-txt').val();
                }else{
                   report_content ='';
                }
            });
        }
        function share(){
            //调取分享函数
            var that =this;
            layer.open({
              type: 2,
              title: '分享到',
              area: ['262px', '327px'],
              content: ['/share?title='+encodeURI($(that).attr('data-title'))+'&url='+$(that).attr('data-url'), 'no']
            });
        }
    })
</script>
</body>
</html>