<!DOCTYPE html>
<html>
{% include "header_new.html" %}
  <!--[if lt IE 10]>
  <script src="{{helper.cdnhost}}/assets/js/upgrade.js"></script>
  <![endif]-->
<style>
    .right-cont{
        width: 878px;
        /*height: 1365px;*/
        /*border: 1px #dcdcdc solid;*/
    }
    .right-cont .loadMore{
        width: 100%;
        height: 40px;
        text-align: center;
        line-height: 40px;
        border-top: 1px solid #dcdcdc;
        cursor: pointer;
        font-size: 14px;
        color: #666;
    }
    .right-title{
        width: 840px;
        height: 40px;
        background: #eee;
        margin-top: 20px;
        margin-left: 20px;
    }
    .right-title .tit{
        width: 115px;
        height: 40px;
        background: #C13232;
        font-size: 18px;
        color: #fff;
        text-align: center;
        line-height: 40px;
        float: left;

    }
    .list-h{
      height:130px;
    }
    .list-h img{
      display: block;
      width:100%;
      height:100%;
    }
</style>
<body style="background: #f5f5f5">
  {% include "widget/top/top.html" %}
  {% import "widget/nav_seventh/nav_seventh.html" as nav_seventh %}
  {{ nav_seventh.nav_seventh(route,tdk.cityid,helper) }}

	<!-- ==广告1== -->
	<div class="dui-layout-lg clearfix list-h" style="margin-top: 20px;" id="AD_{% if login_info.usertype == 1 %}USER{% elif login_info.usertype == 2 %}ADVISOR{% elif login_info.usertype == 3 %}CANZAN{% endif %}_CENTER_COLLECTION_SEAT1"></div>

  <div class="dui-layout-lg clearfix" style="margin-top: 20px;">
    <div class="dui-layout-silde right">
        <div class="clearfix">
            {% import "widget2/community_advisor/community_advisor.html" as community_advisor %}
            {% if login_info.usertype == 1 %} {#用户#}
            {{ community_advisor.user(userinfo,helper) }}
            {% elif login_info.usertype == 2 %} {#顾问#}
            {{ community_advisor.advisor(userinfo,helper,login_info) }}
            {% elif login_info.usertype == 3 %} {#参赞#}
            {{ community_advisor.counsellor(userinfo,helper,login_info) }}
            {% endif %}
        </div>
        {% if login_info.usertype == 1 %} {#用户#}
        {% import "widget2/side_menu/user_side_menu.html" as user_side_menu %}
        {{ user_side_menu.user_side_menu('我的收藏', helper) }}
        {% elif login_info.usertype == 2 %} {#顾问#}
        {% import "widget2/side_menu/adviser_side_menu.html" as adviser_side_menu %}
        {{ adviser_side_menu.adviser_side_menu('我的主页', '我的收藏', helper) }}
        {% elif login_info.usertype == 3 %} {#参赞#}
        {% import "widget2/side_menu/canzan_side_menu.html" as canzan_side_menu %}
        {{ canzan_side_menu.canzan_side_menu('我的主页', '我的收藏', helper) }}
        {% endif %}
    </div>
    <div class="dui-layout-div"></div>
    <div class="dui-layout-con dui-box-shadow">
        <div class="right-cont case-cont">
            <div class="right-title clearfix" style="background: #f3f3f3">
                <div class="tit">我的收藏</div>
            </div>
            {% if collection_data.list.length > 0 %}
            <div class="right-main clearfix collection-list-box">
                {% for item in collection_data.list %}
                    {% if item.category_id == 17 %} {# 案例 #}
                        {% import "widget2/offer/offer.html" as case_fav %}
                        {{ case_fav.case_fav(item, helper) }}
                    {% elif item.category_id < 17 %} {# 专栏 #}
                        {% import "widget2/article/article.html" as article_fav %}
                        {{ article_fav.article_fav(item, helper) }}
                    {% endif %}
                    {% include "widget2/bottom_comment/bottom_comment.html" %}
                {% endfor %}
            </div>
            <div class="loadMore" data-page="1" data-uid="{{userinfo.uid}}">
                <span>加载更多</span>
                <i class="iconfont">&#xe60b;</i>
            </div>
            {% else %}
            {% include "widget2/blank/blank.html" %}
            {% endif %}
        </div>
    </div>
  </div>
  {% include "widget/footer/footer.html" %}
  <script>
    var login_ss = null; //获取用户信息
    if($.cookie('login_ss') != undefined){
        login_ss = JSON.parse($.cookie('login_ss'));  
    }
  </script>
  <script src="{{helper.cdnhost}}/assets/js/show_advert.js"></script>
  <script src="{{helper.cdnhost}}/assets/js/footer.js"></script>
  <script src="{{helper.cdnhost}}/assets/js/nav_seventh.js"></script>
  <script src="{{helper.cdnhost}}/assets/js/follow.js"></script>
  <script src="{{helper.cdnhost}}/assets/js/common/select.js"></script>
  <script src="{{helper.cdnhost}}/assets/js/bottom_comment.js"></script>
  <script src="{{helper.cdnhost}}/assets/js/layer.min.js"></script>
  <script>
    $(function() {
        function appendCaseItem (citem) {
            if(citem.introduce==undefined){
                  citem.introduce ={
                    stu_name:'',
                    school_1:'',
                    school_2:'',
                    school_3:'',
                    dep_1:'',
                    dep_2:'',
                    dep_3:'',
                    admission_time:'',
                    offer_img:[]
                  };
              }
            var cItemHtml = '';
            cItemHtml += '<div class="offers clearfix"><div class="offers-left"><div class="offers-left-img">';
            cItemHtml += '<a target="_blank" href="'+ fn.urlgen("case", citem.id.toString()) +'"><img src="'+fn.avaterimg(citem.uid,'small',citem.user_info.status,citem.user_info.version)+'" ></a></div><div class="offers-left-off">';
            cItemHtml += '<p class="off-p1">' + citem.user_info.realname + '</p>';
            cItemHtml += '<p class="off-p2"> '+ citem.add_time +'&nbsp;&nbsp;<span>来自 : '+  citem.from +'</span></p>';
            cItemHtml += '<a target="_blank" href="'+ fn.urlgen("case", citem.id.toString()) +'" class="offer-title">'+ citem.title +'</a>';
            cItemHtml += '<p class="off-p3">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名&nbsp;:&nbsp;'+ citem.introduce.stu_name +'</p>';
            cItemHtml += '<p class="off-p3">录取院校&nbsp;:&nbsp;'+ citem.introduce.school_1+'&nbsp;&nbsp;'+citem.introduce.school_2+'&nbsp;&nbsp;'+citem.introduce.school_3+'</p>';
            cItemHtml += '<p class="off-p3">录取专业&nbsp;:&nbsp;'+ citem.introduce.dep_1+'&nbsp;&nbsp;'+citem.introduce.dep_2+'&nbsp;&nbsp;'+citem.introduce.dep_3+'</p>';
            cItemHtml += '<p class="off-p3">学&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;历&nbsp;:&nbsp;'+ fn.getEdu(citem.edu_id) +'</p>';
            cItemHtml += '<p class="off-p3">录取时间&nbsp;:&nbsp;'+ citem.introduce.admission_time +'</p>';
            cItemHtml += '<p class="off-p4"><a target="_blank" href="'+ fn.urlgen("case", citem.id.toString()) +'">【查询详情】</a></p>';
            cItemHtml += '</div> </div> <div class="offers-right"> <div class="offers-right-xiala"><div class="offer-opt-bar clearfix"><div class="opt-btn delete" onclick="cancelFav($(this), '+citem.id+')"><i class="iconfont">&#xe8c1;</i><span>删除</span></div></div><div class="offer-xialas"> <span class="offer-xialadd iconfont">&#xe60b;</span> <ul class="offer-xiala"> <li><a  class="dui-text-warning-s report-btn" data-artId="'+citem.id+'" data-catid="'+citem.category_id+'">举报</a></li> <li><a  class="dui-text-warning-s share-btn" data-url="/case/'+citem.id+'" data-title ="'+citem.title+'">分享</a></li> </ul> </div> </div>';
            if (citem.introduce.offer_img && citem.introduce.offer_img.length > 0) {
                cItemHtml += '<div class="offers-right-off"> <div class="offers-right-offs"> <span>Offer展示:</span></div><div class="offers-right-offh">';
                cItemHtml += addCaseImg(citem.introduce.offer_img);
                cItemHtml += '</div></div>';
            }
            cItemHtml += '</div></div>';
            return cItemHtml; //返回案例小模块html
        }
        function appendArticleItem (aitem) {
            var aItemHtml = '';
            aItemHtml += '<div class="art-box clearfix" ><a target="_blank" href="'+ fn.articleUrlgen("blog",aitem.uid.toString(),"article="+aitem.id.toString()) +'"><div class="adviser-head" style="background:url('+fn.avaterimg(aitem.uid,'small',aitem.user_info.status,aitem.user_info.version)+') no-repeat 0 0;background-size: 60px 76px;"></div></a>';
            aItemHtml += '<div class="adviser-info" ><div class="adviser-info-name" >'+ aitem.user_info.realname +'</div><div class="adviser-info-date clearfix" ><span class="adviser-info-date-s">'+ aitem.add_time +'</span><span>来自：'+ aitem.from +'</span></div><div class="adviser-info-title">'+ aitem.title +'</div>';
            aItemHtml += '<div class="offer-opt-bar clearfix"><div class="opt-btn delete" onclick="cancelFav($(this), '+aitem.id+')"><i class="iconfont">&#xe8c1;</i><span>删除</span></div></div>';
            aItemHtml += '<div class="offer-xialas"><span class="offer-xialadd iconfont">&#xe60b;</span><ul class="offer-xiala"><li><a  class="dui-text-warning-s report-btn" data-artId="'+aitem.id+'" data-catid="'+aitem.category_id+'">举报</a></li><li><a  class="dui-text-warning-s share-btn" data-url="'+ fn.articleUrlgen("blog",aitem.uid.toString(),"article="+aitem.id.toString()) +'" data-title ="'+aitem.title+'">分享</a></li></ul></div>';
            aItemHtml += ' <p class="adviser-info-p"><a target="_blank" href="'+ fn.articleUrlgen("blog",aitem.uid.toString(),"article="+aitem.id.toString()) +'" class="dui-text-warning">'+ aitem.introduce +'<span>【查看详情】</span></a></p>';
            aItemHtml += addArticleImg(aitem.img_list);
            aItemHtml += '</div></div>';
            return aItemHtml;
        }
        function appendFav (favArr) {
            var favHtml = '';
            for (var i = 0; i < favArr.length; i++) {
                if (favArr[i].category_id == 17) { //案例
                    favHtml += appendCaseItem(favArr[i]);
                }
                else if (favArr[i].category_id < 17) { //专栏
                    favHtml += appendArticleItem(favArr[i]);
                }
            }
            $('.right-main').append($(favHtml));
            $('.report-btn').on("click",report); //点击举报
            $('.share-btn').on('click',share); //点击分享
        }
        function addCaseImg (imgList) {
            var html = '';
            for (var j=0; j<imgList.length; j++) {
                html += '<div class="img-box" ><img src="'+ fn.imageThumb(imgList[j],'110x130') +'" alt=""></div>';
            }
            return html;
        }
        function addArticleImg (imgList) {
            var html = '<ul id="adviser-info-ul" class="adviser-info-ul clearfix" >';
            for (var j=0; j<imgList.length; j++) {
                html += '<li><img src="'+ fn.imageThumb(imgList[j],'150x150') +'" ></li>';
            }
            html += '</ul>';
            return html;
        }
        var page = 1;
        $('.loadMore').on('click', function () {
            page = page + 1;
            console.log('page',page);
            var uid = $(this).data('uid');
            var per_page = 4;
            var thisObj = $(this);
            $.ajax({
                url: '/soapi/favList',
                type: 'GET',
                datatype: 'json',
                data: {
                    u_id: uid,
                    page: page,
                    per_page: per_page
                },
                success: function (revmsg) {
                    if (revmsg.code == 0) {
                        var revList = revmsg.data.list;
                        var len = revList.length;
                        if (len == 0) {
                            thisObj.html('已展示全部收藏');
                        }
                        if (len < per_page) {
                            thisObj.html('已展示全部收藏');
                            appendFav(revList);
//                            thisObj.data('page', page);
                        }
                        else {
                            appendFav(revList);
//                            thisObj.data('page', page);
                        }
                    }
                    else {
                        thisObj.html('加载更多出错了，请刷新');
                    }
                },
                error:function(XMLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown)
                }
            })
        });
        $('.report-btn').on("click",report); //点击举报
        $('.share-btn').on('click',share); //点击分享
        function report(){
            //举报调取函数
            var report_content = null;
            var that =this;
            layer.open({
                type: 1,
                title:'举报理由',
                area: ['700px'], //宽高
                content:'<div class="report-con">'+
                           '<ul class="report-ul clearfix">'+
                             '<li>'+
                               '<span class="circle"></span>'+
                               '<i class="iconfont">&#xe62a;</i>'+
                               '<span class="sp-con">垃圾、广告信息</span>'+
                              '</li>'+
                              '<li>'+
                                '<span class="circle"></span>'+
                                '<i class="iconfont">&#xe62a;</i>'+
                                '<span class="sp-con">色情、低俗内容</span>'+
                              '</li>'+
                              '<li>'+
                                '<span class="circle"></span>'+
                                '<i class="iconfont">&#xe62a;</i>'+
                                '<span class="sp-con">时政敏感话题</span>'+
                              '</li>'+
                              '<li>'+
                                '<span class="circle"></span>'+
                                '<i class="iconfont">&#xe62a;</i>'+
                                '<span class="sp-con">其它原因</span>'+
                              '</li>'+
                            '</ul>'+
                            '<textarea class="report-txt"></textarea>'+
                        '</div>',
                btn:'确定',
                closeBtn:'2',
                yes: function(index, layero){
                  if(report_content ==undefined || report_content == ''){
                    layer.msg('请选择举报理由');
                    return false;
                  }
                  $.ajax({
                    // url: ajaxUrlPrefix.cmsapi+'/api/userReport',
                    url:'/soapi/userReport',
                    type:'POST',
                    data:{
                      report_source:'1',
                      report_type:'1',
                      report_content:report_content,
                      userid:login_ss.uid,
                      artecle_id:$(that).attr("data-artId"),
                      catid:$(that).attr("data-catid")
                    },
                    dataType:'json',
                    // jsonpCallback:'callback',
                    success:function(result){
                      console.log(result)
                      if(result.code == 0){
                        layer.msg('举报成功');
                        layer.close(index); 
                      }
                    },
                    error:function(XMLHttpRequest, textStatus, errorThrown){
                      console.log(errorThrown)
                    }  
                  });
                }         
            });
            $(".report-ul li").on("click",function(){
                //选择举报内容
                $(".report-ul li i").hide();
                $(".report-ul li .circle").show();
                $(this).find("i").show();
                $(this).find(".circle").hide();
                if($(this).index() == 3){
                  $(".report-txt").show();
                  $(".layui-layer-content").css({"height":"115px"});
                }else{
                  $(".report-txt").hide();
                  $(".layui-layer-content").css({"height":"39px"});
                  report_content = $(this).find('.sp-con').text();
                }
            });
            $('.report-txt').on('change',function(){
                if($('.report-txt').val()!= ''){
                  report_content = $('.report-txt').val();
                }else{
                   report_content ='';
                }
            });
        }
        function share(){
          //调取分享函数
            var that =this;
            layer.open({
              type: 2,
              title: '分享到',
              area: ['262px', '327px'],
              content: ['/share?title='+encodeURI($(that).attr('data-title'))+'&url='+$(that).attr('data-url'), 'no']
            });
        }
    })
  </script>
</body>
</html>