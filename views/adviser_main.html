<!DOCTYPE html>
<html>
<head lang="en">
  {% include "header_new.html" %}
  <link rel="stylesheet" href="{{helper.cdnhost}}/dep/css/idangerous.swiper2.7.6.css" >
  <script src="{{helper.cdnhost}}/dep/js/idangerous.swiper2.7.6.js"></script>
  <style>
    .loadMore {
      width: 100%;
      height: 40px;
      text-align: center;
      line-height: 40px;
      border-top: 1px solid #dcdcdc;
      cursor: pointer;
      font-size: 14px;
      color: #666;
    }
    .list-h{
        height:130px;
    }
    .list-h img{
        display: block;
        width:100%;
        height:100%;
    }
    .homepage {
      width: 880px;
    }
    .homepagecon {
      width: 880px;
      height: 77px;
    }
    .homepageing {
      width: 50px;
      height: 50px;
      border-radius: 25px;
      margin: 16px 10px 10px 20px;
      float: left;
    }
    .homepagecon ul{
       float: right;
      margin-top: 28px;
      margin-right: 10px;
     }
    .homepagecon h3 {
      line-height: 77px;
      font-size: 14px;
      color: #333;
      float: left;
    }
    .homepagecon h3 img {
      margin-left: 4px;
    }
    .homepagecon ul li {
      float: left;
      margin-right: 10px;
    }
    .homepage-title {
      width: 880px;
      height: 30px;
      margin-top: 7px;
    }
    .homepage-title p {
      font-size:16px;
      color: #333;
      margin-left: 20px;
      float: left;
    }
    .homepage-title div {
      width: 80px;
      height: 24px;
      float: left;
      margin-left: 20px;
      background: #C13232;
      opacity: 0.6;
      text-align: center;
      line-height: 24px;
      border-radius:12px ;
      margin-top: -3px;
    }
    .homepage-p {
      width: 840px;
      margin: 0px 20px 12px 20px;
    }
    .homepage-p p {
      line-height: 24px;
      font-size: 12px;
      color: #666;
    }
    .homepage-li {
      width: 840px;
    }
    .homepage-li li img {
      width: 150px;
      height: 150px;
      margin-left: 20px;
      float: left;
    }
    .homepage-span {
      width: 880px;
      height: 44px;
      line-height: 44px;
      background: purple;
    }
  </style>
</head>
<body style="background: #f5f5f5">
{% include "widget/top/top.html" %}
{% import "widget/nav_seventh/nav_seventh.html" as nav_seventh %}
{{ nav_seventh.nav_seventh(route,tdk.cityid,helper) }}
<div class="dui-layout-lg clearfix list-h" style="margin-top: 20px;" id="AD_{% if userinfo.usertype == 2 %}ADVISOR{% elif userinfo.usertype == 3 %}CANZAN{% endif %}_P_MAIN_SEAT1"></div>
<div class="dui-layout-lg clearfix">
  <div class="dui-layout-silde right">
    <div class="clearfix" style="margin-top: 20px">
      {% import "widget2/community_advisor/community_advisor.html" as community_advisor %}
      {% if userinfo.status == 1 %} {#离职#}
        {{ community_advisor.advisor_leave(userinfo,helper,login_info) }}
      {% else %} {#在职#}
        {% if userinfo.usertype == 2 %}
        {{ community_advisor.advisor(userinfo,helper,login_info) }}
        {% elif userinfo.usertype == 3 %}
        {{ community_advisor.counsellor(userinfo,helper,login_info) }}
        {% endif %}
      {% endif %}
    </div>
    <div style="margin-top: 20px;" class="dui-box-shadow">
      <div class="common-title" style="border:1px solid #dcdcdc;">
        <i></i>
        <h3>作者精选</h3>
      </div>
      {% esi helper.include(esikey,'fragment/author_selection','uid='+uid) %}
    </div>
    <div style="margin-top: 20px;" class="dui-box-shadow">
      <div class="common-title" style="border:1px solid #dcdcdc;">
        <i></i>
        <h3>猜你喜欢</h3>
      </div>
      {% esi helper.include(esikey,'fragment/guess_like','n='+country,'c='+tdk.cityid) %}
    </div>
    <div class="huod-lod clearfix dui-box-shadow" style="margin-top: 20px">
      <div class="expert_unscramble_title">
        <i></i><h3>活动预告</h3> <a  target="_blank" href="javascript:void(0);"></a>
      </div>
      <div style="background:#fff">
       {% esi helper.include(esikey,'fragment/huodongyugao','pos=cmslist','c='+tdk.cityid,'n='+hcountry) %}
      </div>
    </div>
  </div>
  <div class="dui-layout-div"></div>
  <div class="dui-layout-con left dui-box-shadow" style="border: 1px solid #eee;margin-left: 20px;margin-top: 20px;width: 878px;background: #fff">
    <div class="" style="margin-top: 20px">
    <div>
      {% import "widget2/community_nav/community_nav.html" as community_nav %}
      {% if userinfo.status == 1 %} {#离职顾问#}
        {{community_nav.adviser_nav_leave('主页', userinfo.uid, helper)}}
      {% else %} {#在职顾问#}
        {% if userinfo.usertype == 2 %}
        {{community_nav.adviser_nav('主页', userinfo.uid, helper)}}
        {% elif userinfo.usertype == 3 %}
        {{community_nav.canzan_nav('主页', userinfo.uid, helper)}}
        {% endif %}
      {% endif %}
    </div>
      {% if guwen_list.list.length > 0 %}
      <div class="right-main clearfix">
          {% for item in guwen_list.list %}
            {% if item.category_id == 17 %} {# 案例 #}         
              {% import "widget2/offer/offer.html" as case_show %}
              {{ case_show.case_show(item, helper) }}
            {% elif item.category_id < 17 %} {# 专栏 #}
              {% import "widget2/article/article.html" as article_show %}
              {{ article_show.article_show(item, helper) }}
            {% endif %}
            {% include "widget2/bottom_comment/bottom_comment.html" %}
          {% endfor %}
      </div>
      <div class="loadMore" data-page="1" data-uid="{{userinfo.uid}}" style="height: 54px;line-height: 54px">
        <span>加载更多</span>
        <i class="iconfont">&#xe60b;</i>
      </div>
      {% else %}
      {% include "widget2/blank/blank.html" %}
      {% endif %}
    </div>
  </div>
</div>
<div class="dui-layout-lg clearfix">
<div class="dui-box-shadow" style="margin-top: 20px;background:#fff;" >
  <div class="common-title">
    <i></i>
    <h3>热门留学方案</h3>
    <a  target="_blank" href="{{helper.urlgen('productrank')}}" class="iconfont">&#xe602;</a>
  </div>
  {% esi helper.include(esikey,'fragment/hot_liuxuefangan_list') %}
</div>
<div class="dui-box-shadow clearfix" style="margin-top: 20px;background:#fff;margin-bottom: 20px;">
  <div class="common-title clearfix">
    <i></i>
    <h3>明星顾问</h3>
    <a  target="_blank" href="{{helper.urlgen('adviser')}}" class="iconfont">&#xe602;</a>
  </div>
    {% esi helper.include(esikey,'fragment/community_guwen','n='+hcountry) %}
</div>
</div>
{% import "widget/slide/slide.html" as  slide %}
{{slide.leyu_slide("AD_"+tdk.pagekey+"_SEAT10") }}
{% include "widget/new_footer/new_footer.html" %}
<script>
  var login_ss = null; 
  if($.cookie('login_ss') != undefined){
    login_ss = JSON.parse($.cookie('login_ss'));  
  }
</script>
<script src="{{helper.cdnhost}}/assets/js/show_advert.js"></script>
<script src="{{helper.cdnhost}}/assets/js/bottom_comment.js"></script>
<script src="{{helper.cdnhost}}/assets/js/nav_seventh.js" ></script>
<script src="{{helper.cdnhost}}/assets/js/follow.js"></script>
<script src="{{helper.cdnhost}}/assets/js/xSlider.js" ></script>
<script src="{{helper.cdnhost}}/assets/js/slide.js"></script>
<script src="{{helper.cdnhost}}/assets/js/online_evaluation.js"></script>
<script src="{{helper.cdnhost}}/assets/js/footer.js"></script>
<script src="{{helper.cdnhost}}/assets/js/layer.min.js"></script>
<script>
  $(function(){
    //明星顾问轮播
    $('.advisor_star_bar .slider').xSlider();
    function appendCaseItem (citem) {
      if(citem.introduce==undefined){
          citem.introduce ={
            stu_name:'',
            school_1:'',
            school_2:'',
            school_3:'',
            dep_1:'',
            dep_2:'',
            dep_3:'',
            admission_time:'',
            offer_img:[]
          };
      }
      var cItemHtml ='<div class="offers clearfix">'+
        '<div class="offers-left">'+
          '<div class="offers-left-img">'+
            '<a  target="_blank" href="'+ fn.urlgen("case", citem.id.toString()) +'">'+
              '<img src="'+fn.avaterimg(citem.uid,'small',citem.user_info.status,citem.user_info.version)+'" >'+
            '</a>'+
          '</div>'+
          '<div class="offers-left-off">'+
            '<p class="off-p1">' + citem.user_info.realname + '</p>'+
            '<p class="off-p2"> '+ citem.add_time +'&nbsp;&nbsp;<span>来自 : '+  citem.from +'</span></p>'+
            '<a  target="_blank" href="'+ fn.urlgen("case", citem.id.toString()) +'" class="offer-title">'+ citem.title +'</a>'+
            '<p class="off-p3">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名&nbsp;:&nbsp;'+ citem.introduce.stu_name +'</p>'+
            '<p class="off-p3">录取院校&nbsp;:&nbsp;'+ citem.introduce.school_1+'&nbsp;&nbsp;'+citem.introduce.school_2+'&nbsp;&nbsp;'+citem.introduce.school_3+'</p>'+
            '<p class="off-p3">录取专业&nbsp;:&nbsp;'+ citem.introduce.dep_1+'&nbsp;&nbsp;'+citem.introduce.dep_2+'&nbsp;&nbsp;'+citem.introduce.dep_3+'</p>'+
            '<p class="off-p3">学&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;历&nbsp;:&nbsp;'+ fn.getEdu(citem.edu_id) +'</p>'+
            '<p class="off-p3">录取时间&nbsp;:&nbsp;'+ citem.introduce.admission_time +'</p>'+
            '<p class="off-p4"><a  target="_blank" href="'+ fn.urlgen("case", citem.id.toString()) +'">【查询详情】</a></p>'+
          '</div>'+
        '</div>'+
        '<div class="offers-right">'+
          '<div class="offers-right-xiala">'+
            '<div class="offer-xialas">'+
              '<span class="offer-xialadd iconfont">&#xe60b;</span>'+
              '<ul class="offer-xiala">'+
                '<li>'+
                  '<a class="dui-text-warning-s report-btn" data-artId="'+citem.id+'" data-catid="'+citem.category_id+'">举报'+
                  '</a>'+
                '</li>'+
                '<li>'+
                  '<a class="dui-text-warning-s share-btn" data-url="'+fn.urlgen("case", citem.id.toString())+'" data-title ="'+citem.title+'">分享'+
                  '</a>'+
                '</li>'+
              '</ul>'+
            '</div>'+
          '</div>'+
          addCaseImg(citem.img_list)+
        '</div>'+
      '</div>'+
      addBottom(citem);
      return cItemHtml; //返回案例小模块html
    }
    function appendArticleItem (aitem) {
      var aItemHtml ='<div class="art-box clearfix" >'+
        '<a  target="_blank" href="'+fn.articleUrlgen("blog",aitem.uid.toString(),"article="+aitem.id.toString()) +'">'+
          '<div class="adviser-head" style="background:url('+fn.avaterimg(aitem.uid,'small',aitem.user_info.status,aitem.user_info.version)+') no-repeat 0 0;background-size: 60px 76px;"></div>'+
        '</a>'+
        '<div class="adviser-info" >'+
          '<div class="adviser-info-name" >'+ aitem.user_info.realname +'</div>'+
          '<div class="adviser-info-date clearfix" >'+
            '<span class="adviser-info-date-s">'+ aitem.add_time +'</span>'+
            '<span>来自：'+ aitem.from +'</span>'+
          '</div>'+
          '<div class="adviser-info-title">'+
            '<a  target="_blank" href="'+fn.articleUrlgen("blog",aitem.uid.toString(),"article="+aitem.id.toString())+'" style="color: #333">'+
              aitem.title+
            '</a>'+
          '</div>'+
          '<div class="offer-xialas">'+
            '<span class="offer-xialadd iconfont">&#xe60b;</span>'+
            '<ul class="offer-xiala">'+
              '<li>'+
                '<a class="dui-text-warning-s report-btn" data-artId="'+aitem.id+'" data-catid="'+aitem.category_id+'">举报'+
                '</a>'+
              '</li>'+
              '<li>'+
                '<a class="dui-text-warning-s share-btn" data-url="'+fn.articleUrlgen("blog",aitem.uid.toString(),"article="+aitem.id.toString())+'" data-title ="'+aitem.title+'">分享'+
                '</a>'+
              '</li>'+
            '</ul>'+
          '</div>'+
          '<p class="adviser-info-p">'+
            '<a  target="_blank" href="'+ fn.articleUrlgen("blog",aitem.uid.toString(),"article="+aitem.id.toString()) +'" class="dui-text-warning">'+ aitem.introduce +'<span>【查看详情】</span>'+
            '</a>'+
          '</p>'+
          addArticleImg(aitem.img_list)+
        '</div>'+
      '</div>'+
      addBottom(aitem);
      return aItemHtml;
    }
    function appendFav (favArr) {
        var favHtml = '';
        for (var i = 0; i < favArr.length; i++) {
            if (favArr[i].category_id == 17) { //案例
                favHtml += appendCaseItem(favArr[i]);
            }
            else if (favArr[i].category_id < 17) { //专栏
                favHtml += appendArticleItem(favArr[i]);
            }
        }
        $('.right-main').append(favHtml);
        $('.report-btn').on("click",report); //点击举报
        $('.share-btn').on('click',share); //点击分享
    }
    function addCaseImg (imgList) {
      if(imgList==undefined){
        return '';
      }
      var html ='<div class="offers-right-off">'+
            '<div class="offers-right-offs">'+
              '<span>Offer展示:</span>'+
            '</div>'+
            '<div class="offers-right-offh">';
      
      for (var j=0;j<imgList.length;j++) {
          html += '<div class="img-box" ><img src="'+ fn.imageThumb(imgList[j],'110x130') +'" alt=""></div>';
      }
      html +='</div></div>';  
      return html;
    }
    function addArticleImg (imgList) {
      if(imgList==undefined){
        return '';
      }
      var html = '<ul id="adviser-info-ul" class="adviser-info-ul clearfix" >';
      for (var j=0; j<imgList.length; j++) {
          html += '<li><img src="'+ fn.imageThumb(imgList[j],'150x150') +'" ></li>';
      }
      html += '</ul>';
      return html;
    }
    function addBottom(item){
      var html ='<div class="bot_comment clearfix">'+
        '<ul>'+
          '<li onclick="showbottom(1, '+item.id+')" id="yuedu_li_'+item.id+'">'+
            '<i class="iconfont " id="yuedu_'+item.id+'">&#xe9ca;</i>'+
            '<span id="yuedu_span_'+item.id+'">阅读（<em id="yuedu_em_'+ item.id +'">'+ item.views +'</em>）</span>'+
          '</li>'+
          '<li onclick="showbottom(2, '+item.id+')" id="shoucang_li_'+item.id+'">'+
            '<i class="iconfont " id="shoucang_'+item.id+'">&#xe7ed;</i>'+
            '<span id="shoucang_span_'+item.id+'">收藏（<em id="shoucang_em_'+ item.id +'">'+ item.favorites +'</em>）</span>'+
          '</li>'+
          '<li onclick="showbottom(3, '+item.id+')" id="pinglun_li_'+item.id+'">'+
            '<i class="iconfont " id="pinglun_'+item.id+'">&#xe61f;</i>'+
            '<span id="pinglun_span_'+item.id+'">评论（<em id="pinglun_em_'+ item.id +'">'+ item.comments +'</em>）</span>'+
          '</li>'+
          '<li class="dian" onclick="showbottom(4, '+item.id+')" id="dianzan_li_'+item.id+'">'+
            '<i class="iconfont " id="dianzan_'+item.id+'">&#xe651;</i>'+
            '<span id="dianzan_span_'+item.id+'">点赞（<em id="dianzan_em_'+ item.id +'">'+ item.votes +'</em>）</span>'+
          '</li>'+
        '</ul>'+
      '</div>';
      return html;
    }
    $('.loadMore').on('click', function () {
        var page = $(this).data('page')*1+1;
        var per_page = 4;
        var thisObj = $(this);
        $.ajax({
            url: '/soapi/loadmore',
            type: 'GET',
            datatype: 'json',
            data: {
              order:"views desc",
              page: page,
              per_page: per_page,
              uid:thisObj.attr("data-uid")
            },
            success: function (revmsg) {
                console.log(revmsg)
                if (revmsg.code == 0) {
                    var revList = revmsg.data.list;
                    var len = revList.length;
                    if (len == 0) {
                        thisObj.html('已展示全部收藏');
                    }
                    if (len < per_page) {
                        thisObj.html('已展示全部收藏');
                        appendFav(revList);
                        thisObj.data('page', page);
                    }else {
                        appendFav(revList);
                        thisObj.data('page', page);
                    }
                }
                else {
                    thisObj.html('加载更多出错了，请刷新');
                }
            },
            error:function(XMLHttpRequest, textStatus, errorThrown){
                console.log(errorThrown)
            }
        })
    });
    $('.report-btn').on("click",report); //点击举报
    $('.share-btn').on('click',share); //点击分享
    function report(){
        //举报调取函数
        if(login_ss == undefined){
            layer.msg('你还没有登录')
            window.setTimeout(function(){
              window.location.href =fn.curlgen('login','h='+window.location.href);
            },1000);
            return false;
        }
        var report_content = null;
        var that =this;
        layer.open({
            type: 1,
            title:'举报理由',
            area: ['700px'], //宽高
            content:'<div class="report-con">'+
                       '<ul class="report-ul clearfix">'+
                         '<li>'+
                           '<span class="circle"></span>'+
                           '<i class="iconfont">&#xe62a;</i>'+
                           '<span class="sp-con">垃圾、广告信息</span>'+
                          '</li>'+
                          '<li>'+
                            '<span class="circle"></span>'+
                            '<i class="iconfont">&#xe62a;</i>'+
                            '<span class="sp-con">色情、低俗内容</span>'+
                          '</li>'+
                          '<li>'+
                            '<span class="circle"></span>'+
                            '<i class="iconfont">&#xe62a;</i>'+
                            '<span class="sp-con">时政敏感话题</span>'+
                          '</li>'+
                          '<li>'+
                            '<span class="circle"></span>'+
                            '<i class="iconfont">&#xe62a;</i>'+
                            '<span class="sp-con">其它原因</span>'+
                          '</li>'+
                        '</ul>'+
                        '<textarea class="report-txt"></textarea>'+
                    '</div>',
            btn:'确定',
            closeBtn:'2',
            yes: function(index, layero){
              if(report_content ==undefined || report_content == ''){
                layer.msg('请选择举报理由');
                return false;
              }
              $.ajax({
                // url: ajaxUrlPrefix.cmsapi+'/api/userReport',
                url:'/soapi/userReport',
                type:'POST',
                data:{
                  report_source:'1',
                  report_type:'1',
                  report_content:report_content,
                  userid:login_ss.uid,
                  artecle_id:$(that).attr("data-artId"),
                  catid:$(that).attr("data-catid")
                },
                dataType:'json',
                // jsonpCallback:'callback',
                success:function(result){
                  console.log(result)
                  if(result.code == 0){
                    layer.msg('举报成功');
                    layer.close(index); 
                  }
                },
                error:function(XMLHttpRequest, textStatus, errorThrown){
                  console.log(errorThrown)
                }  
              });
            }         
        });
        $(".report-ul li").on("click",function(){
            //选择举报内容
            $(".report-ul li i").hide();
            $(".report-ul li .circle").show();
            $(this).find("i").show();
            $(this).find(".circle").hide();
            if($(this).index() == 3){
              $(".report-txt").show();
              $(".layui-layer-content").css({"height":"115px"});
            }else{
              $(".report-txt").hide();
              $(".layui-layer-content").css({"height":"39px"});
              report_content = $(this).find('.sp-con').text();
            }
        });
        $('.report-txt').on('change',function(){
            if($('.report-txt').val()!= ''){
              report_content = $('.report-txt').val();
            }else{
               report_content ='';
            }
        });
    }
    function share(){
      //调取分享函数
        var that =this;
        layer.open({
          type: 2,
          title: '分享到',
          area: ['262px', '327px'],
          content: ['/share?title='+encodeURI($(that).attr('data-title'))+'&url='+$(that).attr('data-url'), 'no']
        });
    }
  })
</script>
</body>
</html>